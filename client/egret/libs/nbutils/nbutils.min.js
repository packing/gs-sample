function calculateIMV2TypeSize(e){switch(e){case IntermediateV2Types.Int8:case IntermediateV2Types.Uint8:return 1;case IntermediateV2Types.Int16:case IntermediateV2Types.Uint16:return 2;case IntermediateV2Types.Float32:case IntermediateV2Types.Int32:case IntermediateV2Types.Uint32:return 4;case IntermediateV2Types.Float64:case IntermediateV2Types.Int64:case IntermediateV2Types.Uint64:return 8;default:return 0}}var useLittleEndian=!1,NBPy={"typeof":function(e){var t=Object.prototype.toString.call(e);return t=t.substring(8,t.length-1).toLowerCase(),"number"==t&&((""+e).indexOf(".")>0&&(""+e).indexOf("e")<=0?t="float":e>4294967295&&(t="number64")),t},UTF8:function(e){for(var t=encodeURIComponent(e),n=[],r=0;r<t.length;r++){var a=t.charAt(r);if("%"===a){var i=t.charAt(r+1)+t.charAt(r+2),s=parseInt(i,16);n.push(s),r+=2}else n.push(a.charCodeAt(0))}for(var u=new DataView(new ArrayBuffer(n.length)),r=0;r<n.length;r++)u.setUint8(r,n[r]);return u},UNICODE:function(e,t,n){for(var r="",a=0;n>a;a++){var i=e.getUint8(t+a,useLittleEndian);r+="%"+i.toString(16)}return decodeURIComponent(r)}},IMDataHeaderLength=5,IntermediateTypes={Unknown:0,Int:1,Int64:2,Str:3,Float:4,Bool:5,Double:6,Map:7,List:8,Buffer:9,PBuffer:10,Memory:11,PyStr:12,Long:13,Short:14,Char:15},IntermediateLengths={number:function(e){return 4},number64:function(e){return 8},"float":function(e){return 4},"boolean":function(e){return 1},string:function(e){return 2*e.length},object:function(e){var t=0;for(var n in e)t++;return t},array:function(e){return e.length}},TypeSwapTables={number:"Int",number64:"Int64",string:"Str","float":"Float","boolean":"Bool",object:"Map",array:"List"},safeNaN=function(e){return isNaN(e)?e:(""+e).indexOf(".")>0&&(""+e).indexOf("e")<=0?parseFloat(e):parseInt(e)},IntermediateV1Codec={decode:function(e){var t=function(e,t,a,i){var s=i;switch(t){case IntermediateTypes.Int:return{o:e.getInt32(s,!0),offset:s+a};case IntermediateTypes.Short:return{o:e.getInt16(s,!0),offset:s+a};case IntermediateTypes.Char:return{o:e.getInt8(s,!0),offset:s+a};case IntermediateTypes.Int64:return{o:e.getFloat64(s,!0),offset:s+a};case IntermediateTypes.Float:return{o:e.getFloat32(s,!0),offset:s+a};case IntermediateTypes.Bool:return{o:1==e.getUint8(s,!0),offset:s+a};case IntermediateTypes.Str:for(var u="",f=0;a>f;f++)u+=String.fromCharCode(e.getUint16(s+f,!0)),f++;return{o:u,offset:s+a};case IntermediateTypes.Map:for(var o={},f=0;a>f;f++){var l=n(e,s);s=l.offset,o[l.o.key]=l.o.val}return{o:o,offset:s};case IntermediateTypes.List:for(var o=new Array,f=0;a>f;f++){var y=r(e,s);s=y.offset,o.push(y.o)}return{o:o,offset:s};default:return{o:null,offset:s}}},n=function(e,n){var r=e.getUint8(n,!0),a=e.getUint32(n+1,!0),i=e.getUint8(n+5,!0),s=e.getUint32(n+6,!0),u=n+10,f=t(e,r,a,u);u=f.offset,(i==IntermediateTypes.Map||i==IntermediateTypes.List)&&(s=e.getUint32(u+1,!0),u+=5);var o=t(e,i,s,u),l={key:f.o,val:o.o};return{o:l,offset:o.offset}},r=function(e,n){var r=e.getUint8(n,!0),a=e.getUint32(n+1,!0),i=n+5;return t(e,r,a,i)},a=new DataView(e),i=r(a,0);return i.o},encode:function(e){var t=function(e){var t=NBPy["typeof"](e),n=IntermediateTypes[TypeSwapTables[t]];if(void 0==n)return console.log("Cannot encode of data type ["+t+"]"),null;var r=IntermediateLengths[t];if(void 0==r)return console.log("Cannot encode of unknown data size"),null;var a=r(e),i=new DataView(new ArrayBuffer(5));return i.setInt8(0,n,!0),i.setInt32(1,a,!0),i},n=function(e,a){var i=e.getInt8(0,!0),s=e.getInt32(1,!0);if(0==s)return console.log("The val length is zero"),null;var u=new DataView(new ArrayBuffer(s));switch(i){case IntermediateTypes.Int:u.setInt32(0,a,!0);break;case IntermediateTypes.Int64:u.setFloat64(0,a,!0);break;case IntermediateTypes.Float:u.setFloat32(0,a,!0);break;case IntermediateTypes.Bool:u.setUint8(0,a?1:0,!0);break;case IntermediateTypes.Str:u=NBPy.UTF8(a),e.setInt32(1,u.byteLength);break;case IntermediateTypes.Map:var f=[],o=0;for(var l in a){var y=safeNaN(l),d=t(y);if(null!=d){var I=t(a[y]);if(null!=I){var c=n(d,y);if(null!=c){var p=I.getInt8(0,!0),g=p==IntermediateTypes.Map||p==IntermediateTypes.List?r(a[y]):n(I,a[y]);if(null!=g){d=new Uint8Array(d.buffer),I=new Uint8Array(I.buffer);var v=d.byteLength+I.byteLength+c.byteLength+g.byteLength,w=new Uint8Array(v),L=0;w.set(d,L),L+=d.byteLength,w.set(I,L),L+=I.byteLength,w.set(c,L),L+=c.byteLength,w.set(g,L),f.push(w),o+=w.byteLength}}}}}var b=new Uint8Array(o),L=0;for(var m in f)L+=m>0?f[m-1].byteLength:0,b.set(f[m],L);return b;case IntermediateTypes.List:var f=[],o=0;for(var y in a){var I=t(a[y]);if(null!=I){var p=I.getInt8(0,!0),g=p==IntermediateTypes.Map||p==IntermediateTypes.List?r(a[y]):n(I,a[y]);if(null!=g){I=new Uint8Array(I.buffer);var v=I.byteLength+g.byteLength,w=new Uint8Array(v),L=0;w.set(I,L),L+=I.byteLength,w.set(g,L),f.push(w),o+=w.byteLength}}}var b=new Uint8Array(o),L=0;for(var m in f)L+=m>0?f[m-1].byteLength:0,b.set(f[m],L);return b;default:return null}return new Uint8Array(u.buffer)},r=function(e){if(header=t(e),!header)return null;var r=new Uint8Array(header.buffer);data=n(header,e),header=r;var a=0;a+=header.byteLength,data&&(a+=data.byteLength);var i=new Uint8Array(a);return i.set(header),data&&i.set(data,header.byteLength),i},a=r(e);return a?new Blob([a.buffer]):null}},IntermediateV2Types={Unknown:0,Int8:1,Uint8:2,Int16:3,Uint16:4,Int32:5,Uint32:6,Int64:7,Uint64:8,Float32:9,Float64:10,Reserved:11,True:12,False:13,String:14,Bytes:15,Map:16,List:17},TypeSwapTablesV2={number:"Int",number64:"Int64",string:"String","float":"Float32","true":"True","false":"False",object:"Map",array:"List"},IntermediateV2Codec={decode:function(e){var t=function(e,n){if(e.byteLength<=n)return null;var r=e.getUint8(n,useLittleEndian),a=n+1,i=r>>7;if(0==i)return{o:r,offset:a};var s=31&r,u=r>>5&3,f=0;switch(u){case 1:if(e.byteLength<2)return null;f=e.getUint8(a,useLittleEndian),a+=1;break;case 2:if(e.byteLength<3)return null;f=e.getUint16(a,useLittleEndian),a+=2;break;case 3:if(e.byteLength<5)return null;f=e.getUint32(a,useLittleEndian),a+=4;break;default:f=calculateIMV2TypeSize(s)}if(s!=IntermediateV2Types.Map&&s!=IntermediateTypes.List&&e.byteLength-a<f)return null;switch(s){case IntermediateV2Types.Int8:return{o:e.getInt8(a,useLittleEndian),offset:a+1};case IntermediateV2Types.Uint8:return{o:e.getUint8(a,useLittleEndian),offset:a+1};case IntermediateV2Types.Int16:return{o:e.getInt16(a,useLittleEndian),offset:a+2};case IntermediateV2Types.Uint16:return{o:e.getUint16(a,useLittleEndian),offset:a+2};case IntermediateV2Types.Int32:return{o:e.getInt32(a,useLittleEndian),offset:a+4};case IntermediateV2Types.Uint32:return{o:e.getUint32(a,useLittleEndian),offset:a+4};case IntermediateV2Types.Float32:return{o:e.getFloat32(a,useLittleEndian),offset:a+4};case IntermediateV2Types.Int64:case IntermediateV2Types.Uint64:case IntermediateV2Types.Float64:return{o:e.getFloat64(a,useLittleEndian),offset:a+8};case IntermediateV2Types.True:return{o:!0,offset:a};case IntermediateV2Types.False:return{o:!1,offset:a};case IntermediateV2Types.String:var o=NBPy.UNICODE(e,a,f);return{o:o,offset:a+f};case IntermediateV2Types.Bytes:var l=new Uint8Array(e.buffer),o=l.slice(a,f);return{o:o,offset:a+f};case IntermediateV2Types.Map:for(var y={},d=0;f>d;d++){var I=t(e,a);if(null==I)return null;a=I.offset;var c=t(e,a);if(null==c)return null;a=c.offset,y[I.o]=c.o}return{o:y,offset:a};case IntermediateV2Types.List:for(var y=[],d=0;f>d;d++){var c=t(e,a);if(null==c)return null;a=c.offset,y.push(c.o)}return{o:y,offset:a};default:return null}};if(e.length<1)return null;var n=new DataView(e),r=t(n,0);return r?r.o:null},encode:function(e){var t=function(e,t){var n=128;switch(n|=31&e,t){case 1:n|=32;break;case 2:n|=64;break;case 4:n|=96}return n},n=function(e,n){var r=4,a=n;if(255>=a){r=1;var i=new DataView(new ArrayBuffer(2)),s=t(e,r);i.setUint8(0,s,useLittleEndian),i.setUint8(1,a,useLittleEndian)}else if(65535>=a){r=2;var i=new DataView(new ArrayBuffer(3)),s=t(e,r);i.setUint8(0,s,useLittleEndian),i.setUint16(1,a,useLittleEndian)}else{r=4;var i=new DataView(new ArrayBuffer(5)),s=t(e,r);i.setUint8(0,s,useLittleEndian),i.setUint32(1,a,useLittleEndian)}return i},r=function(e){if(null==e)return null;var a=NBPy["typeof"](e),i=(IntermediateLengths[a],!1),s=!1,u=0,f=0;switch(a){case"number":i=!0,u=e,f=Math.abs(e),s=0>u;break;case"number64":var o=t(IntermediateV2Types.Int64,0),l=new DataView(new ArrayBuffer(9));return l.setInt8(0,o,useLittleEndian),l.setFloat64(1,e,useLittleEndian),l;case"float":var o=t(IntermediateV2Types.Float32,0),l=new DataView(new ArrayBuffer(5));return l.setInt8(0,o,useLittleEndian),l.setFloat32(1,e,useLittleEndian),l;case"boolean":var o=t(e?IntermediateV2Types.True:IntermediateV2Types.False,0),l=new DataView(new ArrayBuffer(1));return l.setInt8(0,o,useLittleEndian),l;case"string":data=NBPy.UTF8(e);var y=data.byteLength,o=n(IntermediateV2Types.String,y),l=new Uint8Array(y+o.byteLength);return l.set(new Uint8Array(o.buffer)),l.set(new Uint8Array(data.buffer),o.byteLength),l;case"object":var d=[],I=0,c=0;for(var p in e){var g=safeNaN(p),v=r(g);if(null!=v){var w=r(e[p]);if(null!=w){var L=v.byteLength+w.byteLength,l=new Uint8Array(L);l.set(new Uint8Array(v.buffer)),l.set(new Uint8Array(w.buffer),v.byteLength),d.push(l),I+=L,c++}}}var o=n(IntermediateV2Types.Map,c),b=new Uint8Array(I+o.byteLength),m=o.byteLength;b.set(new Uint8Array(o.buffer));for(var c in d)m+=c>0?d[c-1].byteLength:0,b.set(d[c],m);return b;case"array":var d=[],I=0,c=0;for(var p in e){var w=r(e[p]);null!=w&&(d.push(w),I+=w.byteLength,c++)}var o=n(IntermediateV2Types.List,c),b=new Uint8Array(I+o.byteLength),m=o.byteLength;b.set(new Uint8Array(o.buffer));for(var c in d)m+=c>0?d[c-1].byteLength:0,b.set(new Uint8Array(d[c].buffer),m);return b}if(i)if(s){var h=256+u,T=65536+u,U=4294967296+u,o=0;if(h>=0&&255>=h){o=t(IntermediateV2Types.Int8,0);var l=new DataView(new ArrayBuffer(2));return l.setInt8(0,o,useLittleEndian),l.setUint8(1,f,useLittleEndian),l}if(T>=0&&65535>=T){o=t(IntermediateV2Types.Int16,0);var l=new DataView(new ArrayBuffer(3));return l.setInt8(0,o,useLittleEndian),l.setUint16(1,f,useLittleEndian),l}if(U>=0&&4294967295>=U){o=t(IntermediateV2Types.Int32,0);var l=new DataView(new ArrayBuffer(5));return l.setInt8(0,o,useLittleEndian),l.setUint32(1,f,useLittleEndian),l}}else{if(127>=f){var l=new DataView(new ArrayBuffer(1));return l.setUint8(0,f,useLittleEndian),l}if(255>=f){var l=new DataView(new ArrayBuffer(2));return l.setInt8(0,t(IntermediateV2Types.Uint8)),l.setUint8(1,f,useLittleEndian),l}if(65535>=f){var l=new DataView(new ArrayBuffer(3));return l.setInt8(0,t(IntermediateV2Types.Uint16)),l.setUint16(1,f,useLittleEndian),l}if(4294967295>=f){var l=new DataView(new ArrayBuffer(5));return l.setInt8(0,t(IntermediateV2Types.Uint32)),l.setUint32(1,f,useLittleEndian),l}}return null},a=r(e);return a?new Blob([a.buffer]):null}};